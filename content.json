{"meta":{"title":"Forheyin","subtitle":null,"description":null,"author":"Forheyin","url":"http://yoursite.com"},"pages":[{"title":"个人简介","date":"2017-10-10T03:54:25.000Z","updated":"2017-10-23T10:46:01.929Z","comments":true,"path":"about/index.html","permalink":"http://yoursite.com/about/index.html","excerpt":"","text":"徐财志 Web前端开发 现居深圳 Email: forheyin.@163.com"},{"title":"categories","date":"2017-10-10T04:25:16.000Z","updated":"2017-10-10T04:25:16.797Z","comments":true,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2017-10-10T04:22:56.000Z","updated":"2017-10-10T04:22:56.910Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"vue仿网易云音乐(二)","slug":"vue仿网易云音乐-二","date":"2018-04-10T07:31:33.000Z","updated":"2018-04-10T09:08:22.117Z","comments":true,"path":"2018/04/10/vue仿网易云音乐-二/","link":"","permalink":"http://yoursite.com/2018/04/10/vue仿网易云音乐-二/","excerpt":"准备工作 配置路由 封装axios 引入icon图标以及全局css 封装全局方法以及过滤器","text":"准备工作 配置路由 封装axios 引入icon图标以及全局css 封装全局方法以及过滤器 配置路由纵览全局发现歌词页面(musicPlay)，mv播放页面(mvPlay)，以及main页面应该属于兄弟路由，都是index路由下的子路由。(这也是写着写着才发现这样路由布局才合理，所以开始一个项目前要考虑清楚再去行动，切记磨刀不误砍柴工)路由布局如下(route/index.js)123456789101112131415161718192021222324252627282930313233343536373839import Vue from 'vue'import Router from 'vue-router'import index from '@/view/index'import main from '@/view/main'import musicPlay from '@/view/else/musicPlay'import mvPlay from '@/view/else/mvPlay'export default new Router(&#123; routes: [ &#123; // 设置启动时进入此页面 path: '/', redirect: '/find/personRecommend' &#125;, &#123; path: '/index', name: 'index', component: index, children: [ &#123; path: '/mvPlay', name: 'mvPlay', component: mvPlay &#125;, &#123; path: '/musicPlay', name: 'musicPlay', component: musicPlay &#125;, &#123; path: '/main', name: 'main', component: main, children: [ ] &#125; ] &#125; ]&#125;) 封装axios123456789101112131415161718192021222324252627282930import axios from 'axios'axios.interceptors.request.use(function (config) &#123; // 在发送请求之前做些什么 return config&#125;, function (error) &#123; // 对请求错误做些什么 return Promise.reject(error)&#125;)// 添加一个返回拦截器axios.interceptors.response.use(function (response) &#123; // 对返回的数据进行一些处理 // console.log(response) if (response.status === 200) &#123; // console.log(response.data) return response.data &#125; else &#123; console.log(response) &#125;&#125;, function (error) &#123; console.log(error) // if (error.response) &#123; // switch (error.response.status) &#123; // case 401: // // 401 清除token信息并跳转到登录页面 // &#125; // &#125; // 对返回的错误进行一些处理 return Promise.reject(error)&#125;)export default axios 然后就处理接口，我的方法是将每个接口单独的export，然后再进行调用，也可以统一导出，看个人习惯。(api/api.js)12345678910111213141516171819// api.jsimport axios from 'axios'// 获取专辑内容export const album = params =&gt; &#123; return axios.get(`api/album`, params).then(res =&gt; res)&#125;// 获取歌手单曲export const artists = params =&gt; &#123; return axios.get(`api/artists`, params).then(res =&gt; res)&#125;// 调用方法(xxx.vue)import &#123; album, artists &#125; from '@/api/api'album(&#123;params: &#123;id: this.id&#125;&#125;).then((res) =&gt; &#123; console.log(res)&#125;)// 或者artists().then((res) =&gt; &#123; console.log(res)&#125;) 引入icon图标以及全局cssindex.scss里123@import './transition.scss'; // 路由过度动画@import './reset.scss';@import './font/iconfont.css'; // 图标icon 我用的是阿里icon，下载项目后，将相关的文件放入styles/font下","categories":[],"tags":[]},{"title":"vue仿PC网易云音乐(一)","slug":"vue仿PC网易云音乐-一","date":"2018-03-27T09:56:26.000Z","updated":"2018-04-09T08:13:45.163Z","comments":true,"path":"2018/03/27/vue仿PC网易云音乐-一/","link":"","permalink":"http://yoursite.com/2018/03/27/vue仿PC网易云音乐-一/","excerpt":"","text":"项目结构和配置 技术栈 Vue 2.0 vue-router vuex axios","categories":[],"tags":[]},{"title":"vue实现可拖动暂停的audio进度条组件","slug":"audio自定义播放器","date":"2018-03-20T08:56:35.000Z","updated":"2018-04-09T01:51:42.830Z","comments":true,"path":"2018/03/20/audio自定义播放器/","link":"","permalink":"http://yoursite.com/2018/03/20/audio自定义播放器/","excerpt":"问题解决方法 起初做法是这样添加事件，发现这样点击拖动后，mouseup时移除mousemove事件没起作用，还是可以触发mousemove事件，尝试了许久无法解决就换了方法。123456789&lt;div class=\"pro\"&gt; &lt;span&gt;&#123;&#123;currentTime | timeFormat&#125;&#125;&lt;/span&gt; &lt;p id=\"pro\" @click=\"jumpTime($event)\" @mousemove=\"mousemove\" @mouseleave=\"mouseleave\"&gt; &lt;i id=\"line\"&gt;&lt;/i&gt; &lt;em id=\"ems\"&gt;&lt;/em&gt; &lt;b id=\"steps\" @mousedown=\"mousedown\" @mouseup=\"mouseup\"&gt;&lt;/b&gt; &lt;/p&gt; &lt;span&gt;&#123;&#123;duration | timeFormat&#125;&#125;&lt;/span&gt; &lt;/div&gt;","text":"问题解决方法 起初做法是这样添加事件，发现这样点击拖动后，mouseup时移除mousemove事件没起作用，还是可以触发mousemove事件，尝试了许久无法解决就换了方法。123456789&lt;div class=\"pro\"&gt; &lt;span&gt;&#123;&#123;currentTime | timeFormat&#125;&#125;&lt;/span&gt; &lt;p id=\"pro\" @click=\"jumpTime($event)\" @mousemove=\"mousemove\" @mouseleave=\"mouseleave\"&gt; &lt;i id=\"line\"&gt;&lt;/i&gt; &lt;em id=\"ems\"&gt;&lt;/em&gt; &lt;b id=\"steps\" @mousedown=\"mousedown\" @mouseup=\"mouseup\"&gt;&lt;/b&gt; &lt;/p&gt; &lt;span&gt;&#123;&#123;duration | timeFormat&#125;&#125;&lt;/span&gt; &lt;/div&gt; 后面百度了，看了别人的思路，就在mounted里添加事件 12345678910111213mounted () &#123; this.audio = document.getElementById('playSong') this.oDiv1 = document.querySelector('#pro') this.oDiv2 = document.querySelector('#ems') this.oDiv3 = document.querySelector('#steps') this.proWidth = document.querySelector('#line').offsetWidth this.oDiv3.addEventListener('mousedown', (ev) =&gt; &#123; document.addEventListener('mousemove', this.fnMove, false) document.addEventListener('mouseup', this.fnEnd, false) this.fnMove(ev) &#125;, false) this.fnEnd()&#125;, 切换上一曲，下一曲的时候我的思路是 点击触发在audio的上一曲(last)，下一曲(或next)事件，通过eventBus去触发songDet里的播放事件，乍看没问题，然后我切换路由后再去执行last或next事件发现获取歌曲url事件会执行多次，路由切换几次就会触发几次。。。百度后发现是因为eventBus事件没有销毁导致的，然后我就去销毁，还是不行，因为我要在全局都要执行这个方法，如果销毁就只能在songDet页面才有用。(真是考虑欠妥。。。) 后面没用eventBus方法去实现，把播放事件写在audio组件里就可以了。 audio的timeupdate事件来实时监听audio的时间进度 音乐的src是存在vuex里 bus.js（eventBus）用来处理timeupdate监听父组件的事件 点击或移动时根据step计算time赋值给playSong.currentTime123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316&lt;template&gt; &lt;div class=\"audio\"&gt; &lt;div class=\"con\"&gt; &lt;span&gt; &lt;i class=\"iconfont icon-last\" @click=\"last\"&gt;&lt;/i&gt; &lt;/span&gt; &lt;span v-if=\"isPlay\"&gt; &lt;i class=\"iconfont icon-zanting\" @click=\"stop\" &gt;&lt;/i&gt; &lt;/span&gt; &lt;span v-else &gt; &lt;i class=\"iconfont icon-play\" @click=\"play\" &gt;&lt;/i&gt; &lt;/span&gt; &lt;span&gt; &lt;i class=\"iconfont icon-next\" @click=\"add\"&gt;&lt;/i&gt; &lt;/span&gt; &lt;!--&lt;span class=\"iconfont icon-next\" @click=\"next\"&gt;&lt;/span&gt;--&gt; &lt;/div&gt; &lt;div class=\"pro\"&gt; &lt;span&gt;&#123;&#123;currentTime | timeFormat&#125;&#125;&lt;/span&gt; &lt;p id=\"pro\" @click=\"jumpTime($event)\" &gt; &lt;i id=\"line\"&gt;&lt;/i&gt; &lt;em id=\"ems\"&gt;&lt;/em&gt; &lt;b id=\"steps\"&gt;&lt;/b&gt; &lt;/p&gt; &lt;span&gt;&#123;&#123;duration | timeFormat&#125;&#125;&lt;/span&gt; &lt;/div&gt; &lt;div class=\"voice pro\"&gt; &lt;span :class=\"[!isQuiet?'icon-shengyin':'icon-wusheng', 'iconfont']\" @click=\"mute\"&gt;&lt;/span&gt; &lt;p&gt; &lt;i @click=\"jumpVoice($event)\"&gt; &lt;em :style=\"&#123;width: vos + '%'&#125;\"&gt;&lt;/em&gt; &lt;/i&gt; &lt;b :style=\"&#123;left: vo + '%'&#125;\"&gt;&lt;/b&gt; &lt;/p&gt; &lt;/div&gt; &lt;audio class=\"play\" id=\"playSong\" @timeupdate=\"updateLyric\"&gt; &lt;source :src=\"mp3Url\" type=\"audio/ogg\" /&gt; &lt;/audio&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;import Bus from './bus.js'import &#123;mapActions, mapState&#125; from 'vuex'export default &#123; data () &#123; return &#123; mp3Url: '', isPlay: false, step: 0, currentTime: 0, locked: false, isQuiet: false, lastStep: 0, time: 0, vo: 100, vos: 100, volume: 0, audio: '', oDiv1: '', oDiv2: '', oDiv3: '', proWidth: 0 &#125; &#125;, computed: &#123; getPlayState () &#123; return this.$store.state.mp3Url &#125;, getNewId () &#123; return this.$route.query.songSheetId &#125;, // 使用mapGetters后，里面的属性赋值时需要使用set，不然会报错 // Computed property \"xxx\" was assigned to but it has no setter.如下面album的写法 ...mapState([ 'curSongIndex', 'duration', 'tracks' ]), album: &#123; get () &#123; return this.$store.state.album &#125;, set () &#123;&#125; &#125; &#125;, watch: &#123; getPlayState (val) &#123; this.step = 0 this.mp3Url = val this.audio.load() this.isPlay = true this.play() &#125;, getNewId () &#123; this.$store.state.curSongIndex = 0 &#125; &#125;, components: &#123;&#125;, created () &#123; &#125;, mounted () &#123; this.audio = document.getElementById('playSong') this.oDiv1 = document.querySelector('#pro') this.oDiv2 = document.querySelector('#ems') this.oDiv3 = document.querySelector('#steps') this.proWidth = document.querySelector('#line').offsetWidth this.oDiv3.addEventListener('mousedown', (ev) =&gt; &#123; document.addEventListener('mousemove', this.fnMove, false) document.addEventListener('mouseup', this.fnEnd, false) this.fnMove(ev) &#125;, false) this.fnEnd() &#125;, methods: &#123; ...mapActions(&#123; &#125;), updateLyric () &#123; let t = this.audio.currentTime let d = this.duration if (this.$route.path === '/musicPlay') &#123; Bus.$emit('getTarget', t) &#125; this.currentTime = this.audio.currentTime * 1000 if (t &lt;= d / 1000) &#123; this.step = this.currentTime / d * this.proWidth this.oDiv3.style.left = this.step + 'px' this.oDiv2.style.width = this.step + 'px' &#125; if (t &gt;= (d - 200) / 1000) &#123; this.isPlay = false this.step = 0 this.oDiv3.style.left = 0 this.oDiv2.style.width = 0 this.currentTime = 0 this.add() &#125; &#125;, play () &#123; this.isPlay = true if (this.getPlayState) &#123; this.audio.play() &#125; &#125;, stop () &#123; this.isPlay = false this.audio.pause() &#125;, fnMove (e) &#123; this.same(e) &#125;, fnEnd () &#123; document.removeEventListener('mouseup', this.fnEnd, false) document.removeEventListener('mousemove', this.fnMove, false) &#125;, jumpTime (e) &#123; this.same(e) &#125;, same (e) &#123; let oDiv1W = this.oDiv1.offsetWidth let x = e.clientX - 250 if (x &gt;= oDiv1W) &#123; x = oDiv1W &#125; else if (x &lt;= 0) &#123; x = 0 &#125; this.oDiv3.style.left = x + 'px' this.oDiv2.style.width = x + 'px' // 点击或移动时根据step计算time赋值给this.audio.currentTime this.step = x / this.proWidth * 100 this.time = this.step * this.duration / 1000 / 100 this.audio.currentTime = this.time &#125;, // 调声音大小 jumpVoice (e) &#123; this.vo = e.offsetX - 7 this.vos = e.offsetX this.volume = e.offsetX if (this.vo &gt; -0.07) &#123; this.audio.volume = this.vo / 100 this.isQuiet = false &#125; else &#123; this.audio.volume = 0 this.isQuiet = true &#125; &#125;, mute () &#123; this.isQuiet = !this.isQuiet if (this.isQuiet) &#123; this.audio.volume = 0 this.vos = 0 this.vo = -7 &#125; else &#123; this.audio.volume = this.volume / 100 this.vos = this.volume this.vo = this.volume - 7 &#125; &#125;, add () &#123; this.$store.commit('INCREMENT') this.playMus(this.curSongIndex) &#125;, last () &#123; this.$store.commit('DECREMENT') this.playMus(this.curSongIndex) &#125;, playMus (index) &#123; if (index &lt;= this.tracks.length) &#123; let i = this.tracks[index] this.$store.commit('AD', i) this.playMusic(i.id, i.name, i.album.blurPicUrl, i.album.artists) &#125; &#125; &#125;&#125;&lt;/script&gt;&lt;style scoped lang=\"scss\"&gt; .audio &#123; display: flex; align-items: center; line-height: 0; .con &#123; width: 200px; padding: 0 20px; flex-shrink: 0; display: flex; justify-content: center; align-items: center; span &#123; text-align: center; flex: 1; font-size: 30px; color: #c62f2f; cursor: pointer; line-height: unset; i &#123; font-size: 35px; &#125; &amp;:nth-of-type(2) &#123; i &#123; font-size: 40px; &#125; &#125; &#125; &#125; .pro &#123; width: 535px; flex-shrink: 0; display: flex; height: 50px; line-height: 50px; p &#123; flex: 1; width: 100%; display: flex; align-items: center; margin: 0 20px 0 10px; position: relative; b &#123; position: absolute; left: 0; top: 18px; width: 14px; height: 14px; background: #fff; border-radius: 50%; border: 0.5px solid #ddd; cursor: pointer; z-index: 88; &amp;:after &#123; position: absolute; content: ''; width: 4px; height: 4px; background: #c62f2f; border-radius: 50%; top: 4.5px; left: 4.5px; &#125; &#125; i &#123; width: 445px; flex-shrink: 0; height: 4px; background: #C2C2C4; border-radius: 5px; position: relative; &#125; em &#123; position: absolute; width: 0; height: 4px; background: #c62f2f; z-index: 86; border-radius: 5px; &#125; &#125; span &#123; flex: 1; font-size: 12px; text-align: center; &#125; &#125; .voice &#123; width: unset; margin-left: 20px; .iconfont &#123; font-size: 14px; &#125; p &#123; position: relative; i &#123; width: 100px; &#125; &#125; &#125; &#125;&lt;/style&gt;","categories":[],"tags":[]}]}